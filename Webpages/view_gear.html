<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Wizard101 Gear - View Gear</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .header {
            margin-top: 50px;
            font-size: 36px;
            font-weight: bold;
        }
        .tabs {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .tabs a {
            text-decoration: none;
            font-size: 18px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        .tabs a:hover {
            background-color: #0056b3;
        }
        .tabs a.disabled {
            background-color: #a9a9a9;
            cursor: default;
        }
        .dropdowns {
            margin-top: 50px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .dropdowns select {
            font-size: 18px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .dropdowns label {
            font-size: 20px;
            margin-right: 10px;
        }
        .checkbox-group {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .checkbox-group label {
            font-size: 18px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
        }
        table {
            margin-top: 30px;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

    <div class="header">Complete Wizard101 Gear</div>

    <div class="tabs">
        <a href="select_owned_gear.html">Select Owned Gear</a>
        <a href="view_gear.html" class="disabled">View Gear</a>
        <a href="view_sets.html">View Sets</a>
        <a href="create_sets.html">Create Sets</a>
    </div>

    <div class="dropdowns">
        <div>
            <label for="school">School:</label>
            <select id="school" onchange="loadCSV()">
                <option value="Balance">Balance</option>
                <option value="Death">Death</option>
                <option value="Fire">Fire</option>
                <option value="Ice">Ice</option>
                <option value="Life">Life</option>
                <option value="Myth">Myth</option>
                <option value="Storm">Storm</option>
            </select>
        </div>
        <div>
            <label for="itemType">Item Type:</label>
            <select id="itemType" onchange="loadCSV()">
                <option value="Hats">Hat</option>
                <option value="Robes">Robe</option>
                <option value="Boots">Boots</option>
                <option value="Wands">Wand</option>
                <option value="Athames">Athame</option>
                <option value="Amulets">Amulet</option>
                <option value="Rings">Ring</option>
                <option value="Pets">Pet</option>
                <option value="Mounts">Mount</option>
                <option value="Decks">Deck</option>
            </select>
        </div>
        <div>
            <label for="level">Level:</label>
            <select id="level">
                <script>
                    for (let i = 170; i >= 1; i--) {
                        document.write('<option value="' + i + '">' + i + '</option>');
                    }
                </script>
            </select>
        </div>
    </div>

    <div class="checkbox-group">
        <label>Source:</label>
        <label><input type="checkbox" id="gold-vendor" checked> Gold Vendor</label>
        <label><input type="checkbox" id="drop" checked> Drop</label>
        <label><input type="checkbox" id="bazaar" checked> Bazaar</label>
        <label><input type="checkbox" id="crafting" checked> Crafting</label>
        <label><input type="checkbox" id="gold-key" checked> Gold Key</label>
        <label><input type="checkbox" id="stone-key" checked> Stone Key</label>
        <label><input type="checkbox" id="wooden-key" checked> Wooden Key</label>
        <label><input type="checkbox" id="housing-gauntlet" checked> Housing Gauntlet</label>
        <label><input type="checkbox" id="rematch" checked> Rematch</label>
        <label><input type="checkbox" id="quest" checked> Quest</label>
        <label><input type="checkbox" id="one-shot" checked> One Shot Housing Gauntlet</label>
        <label><input type="checkbox" id="fishing" checked> Fishing</label>
        <label><input type="checkbox" id="raid" checked> Raid</label>
        <label><input type="checkbox" id="crowns" checked> Crowns</label>
        <label><input type="checkbox" id="gift-card" checked> Gift Card</label>
        <label><input type="checkbox" id="unavailable" checked> Unavailable</label>
    </div>

    <input type="text" id="search-input" placeholder="Search...">
    <table id="csv-table">
        <!-- CSV Data will be inserted here -->
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function loadCSV() {
                const school = document.getElementById('school').value;
                const itemType = document.getElementById('itemType').value;

                const csvUrl = `https://aboele13.github.io/CompleteW101Gear/${school}_Gear/${school}_${itemType}.csv`;

                Papa.parse(csvUrl, {
                    download: true,
                    header: true,
                    complete: function(results) {
                        const data = results.data;
                        const originalData = data.slice(); // Keep a copy of the original data
                        const table = document.getElementById('csv-table');

                        if (data.length === 0) {
                            console.error('CSV file is empty or failed to parse.');
                            return;
                        }

                        // Create table header
                        const header = table.createTHead();
                        const headerRow = header.insertRow(0);

                        Object.keys(data[0]).forEach(function(key) {
                            const cell = headerRow.insertCell(-1);
                            cell.innerHTML = key;
                            cell.addEventListener('click', function() {
                                sortData(key);
                            });
                        });

                        // Create table body
                        const body = table.createTBody();
                        function updateTableBody(data) {
                            body.innerHTML = '';
                            const fragment = document.createDocumentFragment();
                            data.forEach(function(row) {
                                const bodyRow = document.createElement('tr');
                                Object.values(row).forEach(function(value) {
                                    const cell = document.createElement('td');
                                    cell.innerHTML = value;
                                    bodyRow.appendChild(cell);
                                });
                                fragment.appendChild(bodyRow);
                            });
                            body.appendChild(fragment);
                        }

                        // Apply filters
                        function applyFilters() {
                            const level = document.getElementById('level').value;
                            const checkedSources = Array.from(document.querySelectorAll('.checkbox-group input[type="checkbox"]:checked'))
                                .map(cb => cb.id);

                            let filteredData = originalData.filter(row => {
                                const isLevelMatch = row.Level === level;
                                const isSourceMatch = checkedSources.includes(row.Source) || checkedSources.includes('unavailable');
                                return isLevelMatch && isSourceMatch;
                            });

                            updateTableBody(filteredData);
                        }

                        // Function to sort the data in descending order
                    function sortData(key) {
                        data.sort(function(a, b) {
                            var aValue = a[key];
                            var bValue = b[key];

                            if (isNumeric(aValue) && isNumeric(bValue)) {
                                aValue = parseFloat(aValue);
                                bValue = parseFloat(bValue);

                                if (aValue < bValue) return 1; // Descending
                                if (aValue > bValue) return -1; // Descending
                                return 0;
                            }

                            // Not Numeric
                            if (aValue < bValue) return -1; // Ascending / Alphabetical
                            if (aValue > bValue) return 1; // Ascending / Alphabetical
                            return 0;
                        });
                        updateTableBody(data);
                    }

                        // Add search functionality
                        document.getElementById('search-input').addEventListener('keyup', function() {
                            const searchTerm = this.value.toLowerCase();
                            const filteredData = originalData.filter(function(row) {
                                return Object.values(row).some(function(value) {
                                    return String(value).toLowerCase().includes(searchTerm);
                                });
                            });
                            updateTableBody(filteredData);
                        });

                        // Apply filters on change
                        document.getElementById('level').addEventListener('change', applyFilters);
                        document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(cb => {
                            cb.addEventListener('change', applyFilters);
                        });

                        updateTableBody(data); // Populate table on load
                    },
                    error: function(error) {
                        console.error('Error parsing CSV:', error);
                    }
                });
            }

            loadCSV();
        });
    </script>
</body>
</html>
